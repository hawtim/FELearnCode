<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>纯vue的实现</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<link href="http://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.css" rel="stylesheet">
</head>
<body>
	<div id="app">
		<h1>Hello, Vue.js!</h1>
        <h1 v-show="yes">Yes!</h1>
        <h1 v-show="no">No!</h1>
        <h1 v-show="age >= 25">Age: {{ age }}</h1>
        <h1 v-show="name.indexOf('jack') >= 0">Name: {{ name }}</h1>
		<!-- <counter heading="likes" color="green"></counter>
		<counter heading="dislikes" color="red"></counter> -->
		<div class="list-group">
		    <a class="list-group-item" v-link="{ path: '/home',activeClass:'active'}">Home</a>
		    <a class="list-group-item" v-link="{ path: '/about',activeClass:'active'}">About</a>
		</div>

		<router-view></router-view>
		<div class="row">
			<div class="col-xs-offset-2 col-xs-8">
				<div class="well">
					{{{ msg }}}
				</div>
			</div>
		</div>
	</div>




	<!-- 定义组件 -->
	<template id="home">
	    <div>
	        <h1>Home</h1>
	        <p>{{msg}}</p>
	        <div>
	            <p>当前路径：{{$route.path}}</p>
	            <p>当前参数：{{$route.params | json}}</p>
	            <p>路由名称：{{$route.name}}</p>
	            <p>路由器：{{$route.router}}</p>
	            <p>路由查询参数：{{$route.query | json}}</p>
	            <p>路由匹配项：{{$route.matched | json}}</p>
	        </div>
	    </div>
	    <div>
	        <ul class="nav nav-tabs">
	            <li :class="currentPath == '/home/news' ? 'active': ''">
	                <a v-link="{ path: '/home/news'}">News</a>
	            </li>
	            <li :class="currentPath == '/home/message' ? 'active': ''">
	                <a v-link="{ path: '/home/message'}">Messages</a>
	            </li>
	        </ul>
	        <router-view></router-view>
	    </div>
	</template>
	
	<template id="news">
	    <ul>
	        <li> <a v-link="{ name: 'detail', params: {id: '01'} }">News 01</a></li>
	        <li><a v-link="{ path: '/home/news/detail/02'}">News 02</a></li>
	        <li><a v-link="{ path: '/home/news/detail/03'}">News 03</li>
	    </ul>
	    <router-view></router-view>
	</template>
	<template id="message">
	    <ul>
	        <li>Message 01</li>
	        <li>Message 02</li>
	        <li>Message 03</li>
	    </ul>
	</template>
	<template id="newsdetail">
		<div>
		    News Detail - {{$route.params.id}} ......
		</div>
	</template>
<!-- 定义组件 end -->

<script src="vue.js"></script>
<script src="http://cdn.bootcss.com/vue-router/0.7.13/vue-router.js"></script>
<script>
// 组件构造器，构造获取路由钩子函数执行顺序的组件
var well = new Vue({
    el: '.well',
    data: {
        msg: '',
        color: '#ff0000'
    },
    methods: {
        setColor: function(){
            this.color = '#' + parseInt(Math.random()*256).toString(16)
                        + parseInt(Math.random()*256).toString(16)
                        + parseInt(Math.random()*256).toString(16)
        },
        setColoredMessage: function(msg){
            this.msg +=  '<p style="color: ' + this.color + '">' + msg + '</p>'
        },
        setTitle: function(title){
            this.msg =  '<h2 style="color: #333">' + title + '</h2>'
        }
    }
})


function RouteHelper(name) {
    var route = {
        canReuse: function(transition) {
            well.setColoredMessage('执行组件' + name + '的钩子函数:canReuse')
            return true
            // 参数transition 
            // {Transition}在 canReuse 钩子中只能访问 transition.to 和 transition.from 。
            // 预期返回值
            // 必须返回 Boolean 类型，其他等效的假值（ Falsy values ）会当作 false 对待。
        },
        canActivate: function(transition) {
            well.setColoredMessage('执行组件' + name + '的钩子函数:canActivate')
            transition.next()
            // 调用 transition.next() 可以断定（ resolve ）此钩子函数。调用 transition.abort() 可以无效化并取消此次切换。
        },
        activate: function(transition) {
            well.setColoredMessage('执行组件' + name + '的钩子函数:activate')
            transition.next()
        },
        canDeactivate: function(transition) {
            well.setColoredMessage('执行组件' + name + '的钩子函数:canDeactivate')
            transition.next()
        },
        deactivate: function(transition) {
            well.setColoredMessage('执行组件' + name + '的钩子函数:deactivate')
            transition.next()
        },
        data: function(transition) {
            well.setColoredMessage('执行组件' + name + '的钩子函数:data')
            transition.next()
        }
    }
    return route;
}


var Home = Vue.extend({
    template: '#home',
    data: function() {
        return {
            msg: 'Hello, vue router!',
            currentPath:''
        }
    },
    // route: {
    // 	// data:function(transition) {
    // 	// 	transition.next({

    // 	// 		currentPath:transition.to.path
    // 	// 	})
    // 	// 	console.log(transition.from);
    // 	// 	console.log(transition.to);
    // 	// },
    // },
    ready:function () {
    	console.log((this.$route.matched))
    },
    route:RouteHelper('Home')
})

var News = Vue.extend({
    template: '#news',
    route: RouteHelper('News')
})

var Message = Vue.extend({
    template: '#message',
    route: RouteHelper('Message')
})

var NewsDetail = Vue.extend({
	template:'#newsdetail',
	route: RouteHelper('NewsDetail')
})

var About = Vue.extend({
    template: '<div><h1>About</h1><p>This is the tutorial about vue-router.</p></div>',
    route: RouteHelper('About')
})

// 创建路由器实例
	var router = new VueRouter()
// 创建路由映射
	router.map({
	    '/home': {
	        component: Home,
	        // 定义子路由
	        subRoutes: {
	            '/news': {
	            	name:'news',
	                component: News,
	                subRoutes: {
                    'detail/:id': {
                        name: 'detail',
                        component: NewsDetail
                    }
                }
	            },
	            '/message': {
	                component: Message
	            }
	        }
	    },
	    '/about': {
	        component: About
	    }
	})

	router.beforeEach(function(transition) {
		well.setColor()
		well.setTitle('跳转路径<span class="text-danger">[from = ' + transition.from.path + '], [to = ' + transition.to.path + ']</span>')
		well.setColoredMessage('执行router的全局函数:beforeEach')
		transition.next()
	})
	router.afterEach(function(transition) {
		well.setColoredMessage('执行router的全局函数:afterEach')
	})


	var App = Vue.extend({})
	router.start(App, '#app')
	router.redirect({
    '/': '/home'
})
</script>
</body>
</html>